# -*- makefile -*-
#
# sc68-winamp @configure_input@
#
# (C) 2013 https://sourceforge.net/users/benjihan
#
# Time-stamp: <2013-08-09 00:57:08 ben>

# Autoconf stuff
prefix       := @prefix@
execdir      := @execdir@
libdir       := @libdir@
srcdir       := @srcdir@
host_alias   := @host_alias@

# PACKAGE_URL       := @PACKAGE_URL@
# PACKAGE_BUGREPORT := @PACKAGE_BUGREPORT@
# PACKAGE_STRING    := @PACKAGE_STRING@
# PACKAGE_VERSION   := @PACKAGE_VERSION@
# PACKAGE_TARNAME   := @PACKAGE_TARNAME@
# PACKAGE_NAME      := @PACKAGE_NAME@

# Winamp install dir
WADIR        := '@wa_dir@'
# Winamp SDK
WASDK        := '@wa_sdk@'

# WIndows Platform SDK
#WPSDK        := '@wp_sdk@'

# sc68
sc68_CFLAGS  := @sc68_CFLAGS@
sc68_LIBS    := @sc68_LIBS@

# Toolchain
CC           := @CC@
CPP	     := @CPP@
DEFS         := @DEFS@
CPPFLAGS     := $(DEFS) @CPPFLAGS@ $(sc68_CFLAGS) -I$(WASDK) -I$(WASDK)/wasabi
CFLAGS       := @CFLAGS@
LIBS         := @LIBS@ $(sc68_LIBS)
LDFLAGS      := @LDFLAGS@ $(LIBS) 
STRIP        := $(CC:%gcc=%strip)

all: in_sc68.dll

%.dll: %.o
	$(CC) -shared -o $@ $^ -static-libgcc -static $(LDFLAGS)

# Some autoconf rules
configure: $(srcdir)/configure.ac
	$(SHELL) ./config.status --recheck

%: $(srcdir)/%.in
	$(SHELL) ./config.status

install: all
	install --strip-program=$(STRIP) -s $(prefix)

# .$(RELEASE)-%.o : %.c
# 	$(CC) $(CPPFLAGS) $(CFLAGS) -o "$@" -c $<

# both static and shared on purpose so that zlib is linked as static !

# in_sc68-$(RELEASE).dll: $(objects)

# in_sc68.dll: in_sc68-$(RELEASE).dll
# 	@cp -v -- "$<" "$@" && $(STRIP) $@

# winamp: in_sc68.dll
# 	test -d $(WINAMP_PLUGIN) && install -v $< $(WINAMP_PLUGIN)

# install: winamp

# uninstall:
# 	@test -f $(WINAMP_PLUGIN)/in_sc68.dll && rm -v $(WINAMP_PLUGIN)/in_sc68.dll

clean:
	-rm -f -- *.dll *.o

# info:
# 	@echo "release      : $(RELEASE)"
# 	@echo "toolchain    : $(TOOLCHAIN)"
# 	@echo "Winamp SDK   : $(WASDK)"
# 	@echo "ARCHDIR      : $(ARCHDIR)"
# 	@echo "sc68 CFLAGS  : $(sc68ccf)"
# 	@echo "sc68 LDFLAGS : $(sc68ldf)"
