# -*- makefile -*-
#
# sc68-winamp @configure_input@
#
# (C) 2013 https://sourceforge.net/users/benjihan
#
# Time-stamp: <2013-09-18 06:33:49 ben>

# Autoconf stuff
prefix       := @prefix@
exec_prefix  := @exec_prefix@
libexecdir   := @libexecdir@
libdir       := @libdir@
srcdir       := @srcdir@
host_alias   := @host_alias@

# PACKAGE_URL       := @PACKAGE_URL@
# PACKAGE_BUGREPORT := @PACKAGE_BUGREPORT@
# PACKAGE_STRING    := @PACKAGE_STRING@
# PACKAGE_VERSION   := @PACKAGE_VERSION@
# PACKAGE_TARNAME   := @PACKAGE_TARNAME@
# PACKAGE_NAME      := @PACKAGE_NAME@

# Winamp install dir
WADIR        := '@wa_dir@'
WADLL        := $(WADIR)/Plugins

# Winamp SDK
WASDK        := '@wa_sdk@'
WAINC        := -I$(WASDK) -I$(WASDK)/wasabi

# WIndows Platform SDK
WPSDK        := '@wp_sdk@'

# sc68
sc68_CFLAGS  := @sc68_CFLAGS@
sc68_LIBS    := @sc68_LIBS@

# Toolchain
CC           := @CC@
CPP	     := @CPP@
DEFS         := @DEFS@
CPPFLAGS     := $(DEFS) @CPPFLAGS@ $(sc68_CFLAGS) -I. $(WAINC)
CFLAGS       := @CFLAGS@
LIBS         := @LIBS@ $(sc68_LIBS)
LDFLAGS      := @LDFLAGS@ $(LIBS) 
STRIP        := $(CC:%gcc=%strip)
WINDRES      := $(CC:%gcc=%windres)

VPATH = @srcdir@

all: in_sc68.dll

in_sc68.dll: in_sc68.o resource.o fileinfo.o
	$(CC) -shared -o $@ $^ -static-libgcc -static $(LDFLAGS)

%.o: %.rc
	$(WINDRES) -i $< -o $@

# ======================================================================
# Install and such
# ======================================================================

install: in_sc68.dll 
	install --strip-program=$(STRIP) -D -s $< $(libexecdir)/$<

winamp: in_sc68.dll
	test -n $(WADIR)
	test -d $(WADLL)
	install --strip-program=$(STRIP) -D -s $< $(WADLL)/$<

uninstall:
	@rm -f -v -- $(libexecdir)/in_sc68.dll
	@test -z $(WADIR) || rm -f -v -- $(WINAMP_PLUGIN)/in_sc68.dll

clean:
	-rm -f -- *.dll *.o

distclean: clean
	-rm -fv -- config.* Makefile \
		$(srcdir)/configure $(srcdir)/config.h.in* \
		$(srcdir)/aclocal.m4
	-rm -rf --  $(srcdir)/autom4te.cache

# ======================================================================
# Some autoconf rules
# ======================================================================

configure: configure.ac ./config.status
	(cd $(srcdir) && autoreconf -v)
	$(SHELL) ./config.status --recheck

%: %.in ./config.status
	$(SHELL) ./config.status
